<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generator CV - Covebo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
     /* Ukrycie podglądu CV na telefonach, gdy aktywny jest formularz */
    @media (max-width: 768px) {
        .mobile-view-form #cv-preview-container {
            display: none;
        }
        .mobile-view-preview #cv-form-container {
            display: none;
        }
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
  }
}
</script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="module">
    import React, { useState, useEffect } from 'react';
    import ReactDOM from 'react-dom/client';

    // --- UTILS ---
    const generateUniqueId = () => new Date().getTime().toString() + Math.random().toString(36).substring(2, 9);

    // --- SERVICES/PDFGENERATOR.TS ---
    const generateCanvas = async (elementId) => {
      const originalElement = document.getElementById(elementId);
      if (!originalElement) {
        throw new Error(`Element with id "${elementId}" not found.`);
      }

      const clone = originalElement.cloneNode(true);
      clone.style.position = 'absolute';
      clone.style.top = '0';
      clone.style.left = '-9999px';
      clone.style.width = '210mm';
      clone.style.height = '297mm';
      clone.style.transform = 'none';
      document.body.appendChild(clone);

      try {
        const canvas = await window.html2canvas(clone, {
          scale: 3,
          useCORS: true,
          logging: false,
          width: clone.offsetWidth,
          height: clone.offsetHeight,
          windowWidth: clone.scrollWidth,
          windowHeight: clone.scrollHeight,
        });
        return { canvas, clone };
      } catch (error) {
        document.body.removeChild(clone);
        throw error;
      }
    };

    const generatePdf = async (elementId) => {
      const { canvas, clone } = await generateCanvas(elementId);
      try {
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });
        const a4Width = 210;
        const a4Height = 297;
        pdf.addImage(imgData, 'PNG', 0, 0, a4Width, a4Height);
        pdf.save('cv.pdf');
      } catch (error) {
        console.error("PDF generation failed", error);
        throw error;
      } finally {
        document.body.removeChild(clone);
      }
    };

    const generatePdfBlob = async (elementId, filename = 'cv.pdf') => {
      const { canvas, clone } = await generateCanvas(elementId);
      try {
        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });
        const a4Width = 210;
        const a4Height = 297;
        pdf.addImage(imgData, 'PNG', 0, 0, a4Width, a4Height);
        const blob = pdf.output('blob');
        return new File([blob], filename, { type: 'application/pdf' });
      } catch (error) {
        console.error("PDF blob generation failed", error);
        throw error;
      } finally {
        document.body.removeChild(clone);
      }
    };

    // --- COMPONENTS/ICONS.TSX ---
    const CoveboLogo = (props) => React.createElement('img', { 
        src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaEAAAAyCAYAAADy/yR/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAdOSURBVHhe7Z1/aBxlHcfPdybJSTub5Jyc7GSSM5Kck5zcJJvkJCc5STubnJPc5CS7SW6St5/vO/N4ntd115e7/L7P7/P5/H1dn31d1/Vz/qysra1tLVu2bNm0adOmxYsX28n27dt39erVd/3116+srOzr67vrrrvuueeeu3nz5oULF95///2DBw/esWPHbdu2LV++fP/999+yZcvu3bt348aNL7/88sKFC21ZWVn51VdfHTp06Pbt26+99tqZM2du2bJl06ZNTzzxxF//+td/+ctfHn/88bZu3frEE098991333nnnZaWlkePHv3JT37y+OOP/9Of/vTBBx88cODAsWPH/vCHP9yyZcu+ffu+++67/dM///M/N27cuHz58o8++ujDDz+8e/fuOXPmFBQU3L17d0FBwe7du1tbWzds2DD/kF/4whfWr18/duzYuXPn9vT0/OIXv7h58+Y777zz/fffv23bthEjRly+fHny5Mljx45dt27dqVOnHnjggW+++eazzz574MCBV155Ze3atVu2bNmwYcPu3btXVFScOnXq5s2bd+zYceDAgRUrVhw9evT48eNbt27dsWPHuXPnbtq0adOmTQcPHty1a9fRo0c//fTTf/zjHx944IE9e/acO3dux44d33///bZt2z7++ONffvnlzz///Icffnj58uWNGze+//777777tChQ+PHj/9P//RPmzZtOvfcc2/fvv3NN998//33J0+ePHbs2Pnz5w8cOPCBBx7405/+tGPHjiFDhvyf//N/jh07dsuWLf/0T//02muvvfLKK0eOHPnJT35y8eLFzz777Lvvvrty5cof/OAH33vvvTt37ty/f//SpUsXL158/PjxR48eXb58+bvvvnv16tXff//9nj17bt68+d577/31r3+9bdu2P/zhDzdt2vS3v/3tsmXLtmyZ719++eVXXnnlG9/4xrZt2+b/+eef99xzzyuvvHL37t1vv/322rVr9+zZ88EHH9yyZct33333r3/963nz5n344YebN2/+5je/+fnPf/6LX/zin/70p5999tnly5evWrVq3bp1P/7xj//5n//5559/3rdv34ULFw4cOHDr1q0NGzYsWLDgX//617p1677++uvvvvvu0KFDP/vZz5YuXXrHHXccOnRo8ODBN99884YNG+b/+te/fvOb3/zGN75x9+7df/7zn//xH/9x8uTJR48evXDhwpkzZ375y19++OGHDxw4cM+ePXv27Pn666+/8cYb77333tChQ7/85S+fe+65v/nNb3788cdnzpz5yU9+8vPPPx8/fvyzzz67dOnSL3/5yzfffPPSpUtnz549f/7822+//bvf/e43v/nN//d//7f/8A//0Lhx42nTpt21a9eRI0f+8pe/nDhx4rRp00aOHHnHHXfs2bPnww8/PHXq1LvuuutP//rXXbt2Pfjggw8//PDbb7/98ssv//a3vx05cuS3vvWtv/zlL//yL/9y/fr1a9euffjhh7dt27Z58+Zbbrll//79x44dW7NmzYIFC/7u7/7uj3/849WrV3/wgx/8xS9+8Ytf/OKmTZueffbZX/7ylx07dtyyZcs//elPP/3004EDB/72t7+9evXqj3/84zfffPPzzz+/cuXK5cuX7969e/v27YEDB65fv37z5s2jR49ev379hAkTtm3bNmnSpGHDhn377bd/+MMfHj9+fNeuXR9//PGTJ0++66679u3bt3DhwmXLlh06dOj8+fOffPLJ77//fmjQoGHDhsmTJy9durRt27bbbrt98sknr169enDgwPr161euXLly5cqnn376t7/97T//+c8HDx585ZVXvv/++3PmzPnBD37w1VdfHT58+N69e/ft27dv375FixadOnXq4MGD9+7dW7ly5ffff3/lypWtW7f+4Q9/+I1v/H/l/1+eO3dunnQvVlxcPHDgQPn5+d9///179+6tqKi4ePFiYWGhnJycf/vb327dupWU/G9/+9sbb7wxfPjwkJAQe++99/HjxyUnJ3/88cdp06bNnj1bWVnZtGnTJkyYsG/fPl1d3bZt24YMGTJw4MB9+/YdPnz46dOnv/71rz/++OPp6ekNGza8evXql7/8ZUdHx5IlS8aMGbN3796ffvppSUlJ77777p133lmxYsXw4cOffvrpLVu27Ny5c82aNWPGjNmwYcNbb701duzYoUOHPvnkk0OHDv3zn//89a9/3bdv3/Hjxw8ePJifn5+fn3/bbbesWLFixYpVq1ZdtGjRvn379u/f/+DBgwULFly5cuXrr7/+0ksvDRkyZP369du2bVtUVLRv3z7/X7Ro0bx58zZv3nz69OlXXnnlo48+6u/v//bbbxcuXLhw4cKxY8cuXrx4wIABdevWbdiwYdy4caNHj37xxRfjx49/6623Xnrppdu3b69cubJ9+/Y777zz8ssvT09PX7Vq1VtvvbVhwwb/f++996ZNm7Zt27Zz584VK1b8+OOPBw8evHXr1qxZs4YNG7Zx48ZFixbNmTPnnnvuOeWVV1500UVfffXVhISE1atXnzx58sKFC2vXrln7lP8B3tA+C/U9p7W0tKSlpbW3t6elpZWWllZQUFBSUlJSUrJ58+b+/v729nZZWXnkyJGWlpajR4/W19dXV1dXVFSUlJScPHly7dq1JSUlKSkpCQkJiYmJO3fu3LVrV15eXkJCQlpaWk5OzsKFCyUlJbW1tfn5+d9///2goKCgoKCpqam2traioqKurq6pqamkpOTcuXNnz549f/78uXPnbt26dWJi4tixYxEREQUFBfn5+SUlJc3NzR0dHVFRUX19fV1dXVVVVXZ2dklJyZYtW86ePVtfX19TU3P+/Plnz54lJSUFBQV1dXV5efnFixcvXLhw+fLly5cvz8nJ6ejoGBwcPGrUqFmzZtWqVUuWLFmxYsWCBQuWLl2aNm3axIkTFy1a9MADD0ydOnXkyJEJCQkFBQVVVVVXV1ddXd2KFSsGBgbu3r1bV1c3ZMiQMWPGzJgxY/z48YcOHXrzzTdXr15tPzt48OD8+fPnz58/depUXV3dG2+8sXbt2oYNG1auXLl27drRo0cPHjx49erVoUOH/vjHP37rrbeeeOKJv//970tLSzds2DBixIgxY8YcOnRo2LBhQ4cOLSoqOnfunP+LioqOHj26Z8+effv2HTp0aNeuXQ8++GAgIHDFihUXL17+z//8T0ZGxtChQ7/44ovBwcHbtm175ZVXBgYGbty4ceTIkdHR0QcPHjz//PMHDx783nvvHTlyZMiQIQkJCRkZGQkJCXPmzLlr167Fixd/+umnb775ZuPGjQsWLAwODu7fvz8gIGA1a1bty/xG2o+c95zO+vXr58yZs2vXrqtXr37vvfceeeSRe+6559FHH71+/foRI0YcOHBg4cKFe/furaysnDVr1qZNmz755JOFCxdu2rTp1KlTv/rVr2bNmnXnnXdu3Lixq6vr5ZdfHhAQ0N3dPWnSpGXLlj3zzDPPPPNMQUHBnj171q9fv3HjxpUrV77xxhuvv/56R0dHSUnJyZMnP/744/Pnz7927dqlS5fGjh17xRVX9OvX7+OPPx4yZMjHH388ZsyYNWvWfOtb39q1a9cbb7yxc+fOWbNmXbx48eLFi0+ePHnixIlLly5dsGDBmjVrNmzYsGHDBkOHDh03btyqVasWL16ck5PT09OzZ8+ePn36/Pnza2pq+vbtGxoaysrKys7O3r9/f15eXkZGxsKFC19++eUnn3wycuTI+fPn58yZs3v37oKCglevXu3p6blx48b8/PwLFy4MHjxo4K7fH58jY05F55zOysrK06dPV6xYsXPnzg8++ODu3buZmZklJSWXLl1avXp1ZWVlc3PznXfe2b9//0GDBiUnJzc1NTV1dVU3mOXLly9dujQoKCi3vG/evFlZWXnrrbe2b98+cuTIuXPnLl++fPz48ePHjx89erQd77Zt24oVK956660VK1Zs2bJlzZo1d9xxxyuvvPKZZ56ZPn36V1999eKLL6akpPTu3fvLL788duzYvn37Nm3atG/fvnPnzl25cmXFihVbtmzp37//rVu3JkyY0NDQsG3btj179txyyy0LFy78/e9/nzlz5qxZs5599tlatWr9/ve/T5w4UVRUVFNTU1JSsmnTJt/8J3QGf8V5z+mMHDlyyZIljzzyyNWrVxctWvSBBx5YunTpySefnJyc/Oijj6ZPnz5ixIjFixfv2LFj8ODBN9100y9/+ctvvfXWtGnTvva1rx04cGCXLl2GDx9+5pln/v73v//FL34xatSoOXPmHD169LXXXnvttdc+/PDD4cOHd3R0fPXVVz/99NP/+I//GDx48EcffXTjjTfOmjVr5syZa9asWbhw4dq1a3///fdLlizZuXNnQ0PDwYMHl5aWbtmyZceOHe+//35xcXFXV1dlZWVBQcHKlSsXLly4YMGCxYsXz58//+uvv27evPnBBx8MHDhw//79W7Zs2bFjx549e+bNm3f58uVTp0699tprJ0+efOONN1avXl1XV3f//v179uypq6urqamx+96c857TWVhYOHz4cGNjY1NT05s3b54+fVpSUtLW1tbW1ubn5z/++OMNGza8/PLLS5cuHT58+NixY3PmzBk/fnx3d3dfX9+ePXsOHDiwfft2VVXVRx99tGzZsjlz5ty7d29NTc3SpUsfeeSRpKQkc3Pze++9N23atEWLFu3du7ehocGn6V26dGnlypXTp08/fvx4f3//wsLC+fPnr169+vLly5WVlQULFiQkJLS1tbW0tOTl5f3nP//59NNPp6enX3nllTfeeOPChQsHDx5saGiYOXPmHTt2FBQUDBo0qKCgoK6ubt++ffPmzbtz587Zs2f/+c9/vvHGG0eOHHnrrbeeO3fuzZs3T5kyZfv27Vu3bl1YWNjV1XXkyJHvv/9+SEjIfXfdH3Eecj5gAAAAAElFTkSuQmCC",
        alt: "Covebo Agencja Zatrudnienia",
        ...props
    });

    const ConveyorIcon = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round", ...props },
        React.createElement('path', { d: "M10.25 2.75a2.5 2.5 0 0 0-4.5 0" }),
        React.createElement('path', { d: "M7.5 2.75v12.5" }),
        React.createElement('path', { d: "m18 15.25-2.5-2.5" }),
        React.createElement('path', { d: "m15.5 15.25 2.5-2.5" }),
        React.createElement('path', { d: "m13 15.25-2.5-2.5" }),
        React.createElement('path', { d: "m10.5 15.25 2.5-2.5" }),
        React.createElement('path', { d: "M12.25 21.25h-9a1 1 0 0 1-1-1v-4.5a1 1 0 0 1 1-1h13.5a1 1 0 0 1 1 1v4.5a1 1 0 0 1-1 1h-2.25" }),
        React.createElement('circle', { cx: "18", cy: "18", r: "3.25" })
    );

    const ScannerIcon = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round", ...props },
        React.createElement('path', { d: "M5.5 4.75a1 1 0 0 1 1-1h11a1 1 0 0 1 1 1v14.5a1 1 0 0 1-1-1h-11a1 1 0 0 1-1-1Z" }),
        React.createElement('path', { d: "M8.5 8.75h7" }),
        React.createElement('path', { d: "M8.5 12.75h4" }),
        React.createElement('path', { d: "M21.25 10.75a4.5 4.5 0 0 0 0 3" })
    );

    // --- COMPONENTS/CVPREVIEW.TSX ---
    const SectionTitle = ({ children }) => React.createElement('h2', { className: "text-[#E31D2A] text-lg tracking-[0.3em] font-semibold mb-6 uppercase" }, children);

    const CvPreview = ({ cvData, id }) => {
      const { name, profilePictureUrl, dob, personalDetails, skills, languages, workExperience, education } = cvData;
      return React.createElement('div', { id: id, className: "bg-white text-black w-[210mm] h-[297mm] shadow-2xl flex flex-col", style: { fontFamily: "'Poppins', sans-serif" } },
        React.createElement('header', { className: "bg-[#E31D2A] md:rounded-br-[60px] pt-8 pb-28 md:pt-8 md:pb-8 md:pl-10 text-white relative md:h-[200px]" },
          React.createElement('div', { className: "flex flex-col md:flex-row items-center md:items-start text-center md:text-left" },
            React.createElement('div', { className: "w-full mt-4 md:mt-0 flex flex-col md:flex-row justify-center md:justify-between items-center" },
              React.createElement('div', { className: "text-center md:text-left" },
                React.createElement('h1', { className: "text-4xl md:text-5xl font-bold leading-tight tracking-wide break-words" }, name || 'Imię i Nazwisko'),
                dob && React.createElement('p', { className: "text-sm md:text-base font-light mt-2 tracking-wide opacity-90" }, dob)
              ),
              React.createElement('div', { className: "flex flex-row md:flex-col gap-3 mt-4 md:mt-0" },
                React.createElement('div', { className: "w-16 h-16 bg-white/20 rounded-full flex items-center justify-center border-2 border-white/50 shrink-0" },
                  React.createElement(ConveyorIcon, { className: "w-8 h-8" })
                ),
                React.createElement('div', { className: "w-16 h-16 bg-white/20 rounded-full flex items-center justify-center border-2 border-white/50 shrink-0" },
                  React.createElement(ScannerIcon, { className: "w-8 h-8" })
                )
              )
            )
          ),
          React.createElement('div', { className: "absolute top-[120px] md:top-[80px] left-1/2 md:left-10 transform -translate-x-1/2 md:translate-x-0 w-[180px] h-[180px] rounded-full bg-white p-2 shadow-lg" },
            React.createElement('img', { src: profilePictureUrl || `https://picsum.photos/seed/${name || 'placeholder'}/180`, alt: name, className: "w-full h-full rounded-full object-cover" })
          )
        ),
        React.createElement('main', { className: "flex flex-col md:flex-row pt-32 md:pt-24 flex-grow" },
          React.createElement('div', { className: "w-full md:w-[38%] p-6 md:pl-10 md:pr-6 md:pb-8 order-2 md:order-1" },
            React.createElement('div', { className: "bg-gray-100 p-6 flex flex-col h-full" },
                React.createElement('div', null,
                  personalDetails && personalDetails.length > 0 && React.createElement('div', { className: "mb-6" },
                    React.createElement('h3', { className: "text-[#E31D2A] text-xs font-bold tracking-[0.15em] uppercase mb-1" }, "Uprawnienia"),
                    React.createElement('div', { className: "space-y-1" },
                      personalDetails.map(detail => React.createElement('p', { key: detail.id, className: "text-sm text-black font-normal break-words" }, detail.text))
                    )
                  ),
                  skills && skills.length > 0 && React.createElement('div', { className: "mb-6" },
                    React.createElement('h3', { className: "text-[#E31D2A] text-xs font-bold tracking-[0.15em] uppercase mb-1" }, "Dodatkowe umiejętności"),
                    React.createElement('div', { className: "space-y-1" },
                      skills.map(skill => React.createElement('p', { key: skill.id, className: "text-sm text-black font-normal break-words" }, skill.text))
                    )
                  ),
                  languages && languages.length > 0 && React.createElement('div', null,
                    React.createElement('h3', { className: "text-[#E31D2A] text-xs font-bold tracking-[0.15em] uppercase mb-1" }, "Znajomość języków obcych"),
                    React.createElement('div', { className: "space-y-1" },
                      languages.map(language => React.createElement('p', { key: language.id, className: "text-sm text-black font-normal break-words" }, language.text))
                    )
                  )
                ),
                React.createElement('div', { className: 'mt-auto pt-6 flex justify-end' },
                    React.createElement(CoveboLogo, {
                        className: "h-10 w-auto"
                    })
                )
            )
          ),
          React.createElement('div', { className: "w-full md:w-[62%] p-6 md:pr-10 order-1 md:order-2" },
            workExperience && workExperience.length > 0 && React.createElement(React.Fragment, null,
              React.createElement(SectionTitle, null, "Work Experience"),
              workExperience.map((exp) => React.createElement('div', { key: exp.id, className: "mb-4 p-4 bg-gray-100 rounded" },
                React.createElement('p', { className: "font-bold text-sm tracking-wide break-words" }, `${exp.jobTitle}, ${exp.company}`),
                React.createElement('p', { className: "text-xs text-gray-600 mb-2" }, exp.dateRange),
                React.createElement('ul', { className: "list-disc pl-5 text-xs space-y-1" },
                  exp.tasks.map(task => React.createElement('li', { key: task.id, className: "break-words font-semibold" }, task.text))
                )
              ))
            ),
            education && education.length > 0 && React.createElement('div', { className: "mt-8" },
              React.createElement(SectionTitle, null, "Education"),
              education.map((edu) => React.createElement('div', { key: edu.id, className: "mb-4 p-4 bg-gray-100 rounded" },
                React.createElement('p', { className: "font-bold text-sm tracking-wide break-words" }, `${edu.degree}, ${edu.schoolName}`),
                React.createElement('p', { className: "text-xs text-gray-600 mb-2" }, edu.dateRange),
                edu.description && React.createElement('p', { className: "text-xs mt-1 break-words font-semibold" }, edu.description)
              ))
            )
          )
        )
      );
    };

    // --- COMPONENTS/CVFORM.TSX ---
    const Input = ({ label, value, onChange, placeholder = "" }) => React.createElement('div', { className: "mb-3" },
      React.createElement('label', { className: "block text-sm font-medium text-gray-600 mb-1" }, label),
      React.createElement('input', { type: "text", value: value, onChange: onChange, placeholder: placeholder, className: "w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-red-500 focus:border-red-500" })
    );

    const Section = ({ title, children }) => React.createElement('div', { className: "mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50/50" },
      React.createElement('h3', { className: "text-lg font-bold text-gray-800 mb-4 border-b pb-2" }, title),
      children
    );

    const CvForm = ({ cvData, setCvData }) => {
      const handleFieldChange = (field, value) => {
        setCvData(prev => ({ ...prev, [field]: value }));
      };

      const handleImageUpload = (event) => {
        const file = event.target.files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            setCvData(prev => ({ ...prev, profilePictureUrl: reader.result }));
          };
          reader.readAsDataURL(file);
        }
      };

      const handleDynamicChange = (section, itemId, field, value) => {
        const items = cvData[section];
        const newItems = items.map((item) =>
          item.id === itemId ? { ...item, [field]: value } : item
        );
        setCvData(prev => ({ ...prev, [section]: newItems }));
      };

      const handleTaskChange = (workId, taskId, value) => {
        const newWorkExperience = cvData.workExperience.map((work) => {
          if (work.id === workId) {
            const newTasks = work.tasks.map(task =>
              task.id === taskId ? { ...task, text: value } : task
            );
            return { ...work, tasks: newTasks };
          }
          return work;
        });
        setCvData(prev => ({ ...prev, workExperience: newWorkExperience }));
      };

      const addTask = (workId) => {
        const newWorkExperience = cvData.workExperience.map((work) => {
          if (work.id === workId) {
            return { ...work, tasks: [...work.tasks, { id: generateUniqueId(), text: '' }] };
          }
          return work;
        });
        setCvData(prev => ({ ...prev, workExperience: newWorkExperience }));
      };

      const removeTask = (workId, taskId) => {
        const newWorkExperience = cvData.workExperience.map((work) => {
          if (work.id === workId) {
            return { ...work, tasks: work.tasks.filter(task => task.id !== taskId) };
          }
          return work;
        });
        setCvData(prev => ({ ...prev, workExperience: newWorkExperience }));
      };

      const addItem = (section) => {
        const id = generateUniqueId();
        let newItem;
        switch (section) {
          case 'personalDetails':
          case 'skills':
          case 'languages':
            newItem = { id, text: '' };
            break;
          case 'workExperience':
            newItem = { id, jobTitle: '', company: '', dateRange: '', tasks: [{ id: generateUniqueId(), text: '' }] };
            break;
          case 'education':
            newItem = { id, schoolName: '', degree: '', dateRange: '', description: '' };
            break;
          default:
            return;
        }
        setCvData(prev => ({ ...prev, [section]: [...prev[section], newItem] }));
      };

      const removeItem = (section, id) => {
        setCvData(prev => ({ ...prev, [section]: prev[section].filter(item => item.id !== id) }));
      };

      return React.createElement('div', { className: "space-y-6" },
        React.createElement(Section, { title: "Podstawowe informacje" },
          React.createElement(Input, { label: "Imię i nazwisko", value: cvData.name, onChange: e => handleFieldChange('name', e.target.value), placeholder: "Jan Kowalski" }),
          React.createElement('div', { className: "mb-3" },
            React.createElement('label', { className: "block text-sm font-medium text-gray-600 mb-1" }, "Zdjęcie profilowe"),
            React.createElement('input', { type: "file", accept: "image/*", onChange: handleImageUpload, className: "w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-red-500 focus:border-red-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100" })
          ),
          React.createElement(Input, { label: "Data urodzenia", value: cvData.dob, onChange: e => handleFieldChange('dob', e.target.value), placeholder: "16/10/1985" })
        ),
        ['personalDetails', 'skills', 'languages'].map(sectionKey => {
          const titleMap = { personalDetails: 'Uprawnienia', skills: 'Dodatkowe umiejętności', languages: 'Znajomość języków obcych' };
          const placeholderMap = { personalDetails: 'np. EUROPEAN CERTIFICATE forklift driver', skills: 'np. Obsługa wózka widłowego', languages: 'np. Angielski - komunikatywny' };
          
          return React.createElement(Section, { title: titleMap[sectionKey], key: sectionKey },
            cvData[sectionKey].map((item) =>
              React.createElement('div', { key: item.id, className: "flex gap-2 items-center mb-2" },
                React.createElement('input', { type: "text", placeholder: placeholderMap[sectionKey], value: item.text, onChange: e => handleDynamicChange(sectionKey, item.id, 'text', e.target.value), className: "flex-grow border border-gray-300 rounded-md p-2 text-sm" }),
                React.createElement('button', { onClick: () => removeItem(sectionKey, item.id), className: "text-red-500 hover:text-red-700 text-2xl font-light" }, "×")
              )
            ),
            React.createElement('button', { onClick: () => addItem(sectionKey), className: "mt-2 text-sm text-red-600 font-semibold" }, "+ Dodaj")
          )
        }),
        React.createElement(Section, { title: "Doświadczenie zawodowe" },
          cvData.workExperience.map((exp) =>
            React.createElement('div', { key: exp.id, className: "p-3 border rounded-md mb-3 bg-white relative" },
              React.createElement('button', { onClick: () => removeItem('workExperience', exp.id), className: "absolute top-1 right-2 text-red-500 hover:text-red-700 text-2xl font-light" }, "×"),
              React.createElement('input', { placeholder: "Stanowisko", value: exp.jobTitle, onChange: e => handleDynamicChange('workExperience', exp.id, 'jobTitle', e.target.value), className: "w-full border-b p-1 mb-2 text-sm" }),
              React.createElement('input', { placeholder: "Firma", value: exp.company, onChange: e => handleDynamicChange('workExperience', exp.id, 'company', e.target.value), className: "w-full border-b p-1 mb-2 text-sm" }),
              React.createElement('input', { placeholder: "Okres", value: exp.dateRange, onChange: e => handleDynamicChange('workExperience', exp.id, 'dateRange', e.target.value), className: "w-full border-b p-1 mb-2 text-sm" }),
              React.createElement('div', { className: "mt-3 pt-2 border-t" },
                React.createElement('p', { className: "text-xs font-semibold mb-1 text-gray-500" }, "Zadania:"),
                exp.tasks.map((task) =>
                  React.createElement('div', { key: task.id, className: "flex gap-2 items-center mb-1" },
                    React.createElement('input', { type: "text", placeholder: "Opis zadania", value: task.text, onChange: e => handleTaskChange(exp.id, task.id, e.target.value), className: "flex-grow border border-gray-200 rounded-md p-1 text-sm" }),
                    React.createElement('button', { onClick: () => removeTask(exp.id, task.id), className: "text-gray-400 hover:text-red-500 text-xl leading-none font-light p-1" }, "–")
                  )
                ),
                React.createElement('button', { onClick: () => addTask(exp.id), className: "mt-2 text-xs text-red-600 font-semibold flex items-center gap-1" },
                  React.createElement('span', { className: "text-lg leading-none" }, "+"), "Dodaj Zadanie"
                )
              )
            )
          ),
          React.createElement('button', { onClick: () => addItem('workExperience'), className: "mt-2 text-sm text-red-600 font-semibold" }, "+ Dodaj doświadczenie")
        ),
        React.createElement(Section, { title: "Wykształcenie" },
          cvData.education.map((edu) =>
            React.createElement('div', { key: edu.id, className: "p-3 border rounded-md mb-3 bg-white relative" },
              React.createElement('button', { onClick: () => removeItem('education', edu.id), className: "absolute top-1 right-2 text-red-500 hover:text-red-700 text-2xl font-light" }, "×"),
              React.createElement('input', { placeholder: "Nazwa szkoły/uczelni", value: edu.schoolName, onChange: e => handleDynamicChange('education', edu.id, 'schoolName', e.target.value), className: "w-full border-b p-1 mb-2 text-sm" }),
              React.createElement('input', { placeholder: "Kierunek/Stopień", value: edu.degree, onChange: e => handleDynamicChange('education', edu.id, 'degree', e.target.value), className: "w-full border-b p-1 mb-2 text-sm" }),
              React.createElement('input', { placeholder: "Okres", value: edu.dateRange, onChange: e => handleDynamicChange('education', edu.id, 'dateRange', e.target.value), className: "w-full border-b p-1 mb-2 text-sm" }),
              React.createElement('textarea', { placeholder: "Dodatkowy opis", value: edu.description, onChange: e => handleDynamicChange('education', edu.id, 'description', e.target.value), className: "w-full border p-1 text-sm mt-2 rounded-md", rows: 2 })
            )
          ),
          React.createElement('button', { onClick: () => addItem('education'), className: "mt-2 text-sm text-red-600 font-semibold" }, "+ Dodaj wykształcenie")
        )
      );
    };

    // --- APP.TSX ---
    const initialCvData = {
      name: '',
      profilePictureUrl: '',
      dob: '',
      personalDetails: [],
      skills: [],
      languages: [],
      workExperience: [],
      education: []
    };

    function App() {
      const [cvData, setCvData] = useState(initialCvData);
      const [mobileView, setMobileView] = useState('form');

      useEffect(() => {
        document.body.className = `bg-gray-100 mobile-view-${mobileView}`;
      }, [mobileView]);
      
      const handleDownloadPdf = async () => {
        try {
          await generatePdf('cv-to-print');
        } catch (error) {
          console.error("Failed to generate PDF", error);
          alert("Błąd podczas generowania PDF. Sprawdź konsolę, aby uzyskać więcej informacji.");
        }
      };

      const handleShare = async (type) => {
        try {
          const pdfFile = await generatePdfBlob('cv-to-print', `CV_${cvData.name.replace(/\s/g, '_') || 'Kandydat'}.pdf`);
          const shareData = {
            title: `CV - ${cvData.name}`,
            text: type === 'email' ? `Przesyłam w załączeniu moje CV.\n\nPozdrawiam,\n${cvData.name}` : `Przesyłam moje CV`,
            files: [pdfFile]
          };

          if (navigator.share && navigator.canShare && navigator.canShare({ files: [pdfFile] })) {
            await navigator.share(shareData);
          } else {
            const url = URL.createObjectURL(pdfFile);
            const a = document.createElement('a');
            a.href = url;
            a.download = pdfFile.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            if (type === 'email') {
              const subject = `CV - ${cvData.name}`;
              const body = `Dzień dobry,\n\nW załączeniu przesyłam moje CV (plik został pobrany automatycznie).\n\nPozdrawiam,\n${cvData.name}`;
              const mailtoUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
              window.location.href = mailtoUrl;
              setTimeout(() => {
                alert('PDF zostało pobrane.\nOkno email zostało otwarte - pamiętaj załączyć pobrany plik!')
              }, 1000);
            } else {
              alert('PDF zostało pobrane. Teraz możesz je ręcznie udostępnić przez WhatsApp:\n\n1. Otwórz WhatsApp\n2. Wybierz rozmowę\n3. Kliknij ikonę załącznika\n4. Wybierz pobrany plik CV');
            }
          }
        } catch (error) {
          console.error("Share failed", error);
          alert("Błąd podczas udostępniania. Spróbuj najpierw pobrać PDF przyciskiem 'Pobierz PDF'.");
        }
      };

      return React.createElement('div', { className: "min-h-screen flex flex-col items-center p-4 md:p-8" },
        React.createElement('header', { className: "w-full max-w-7xl mb-6 bg-white p-4 rounded-lg shadow-lg flex justify-between items-center flex-wrap gap-4" },
          React.createElement('h1', { className: "text-xl font-bold text-gray-800" }, "Generator CV Covebo"),
          React.createElement('div', { className: "flex flex-wrap space-x-2" },
            React.createElement('button', { onClick: handleDownloadPdf, className: "bg-red-600 hover:bg-red-700 text-white text-sm font-semibold py-2 px-4 rounded-md transition duration-150 hidden md:inline-flex items-center gap-2" }, "Pobierz PDF"),
            React.createElement('button', { onClick: () => handleShare('whatsapp'), className: "bg-green-500 hover:bg-green-600 text-white text-sm font-semibold py-2 px-4 rounded-md transition duration-150 flex items-center gap-2" }, "Udostępnij (WhatsApp)"),
            React.createElement('button', { onClick: () => handleShare('email'), className: "bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold py-2 px-4 rounded-md transition duration-150 flex items-center gap-2" }, "Udostępnij (Email)")
          )
        ),
        React.createElement('div', { className: "w-full max-w-7xl mb-4 flex md:hidden justify-center space-x-4" },
          React.createElement('button', { onClick: () => setMobileView('form'), className: `py-2 px-4 rounded-lg font-semibold transition ${mobileView === 'form' ? 'bg-red-600 text-white' : 'bg-white text-gray-700 border border-gray-300'}` }, "Formularz"),
          React.createElement('button', { onClick: () => setMobileView('preview'), className: `py-2 px-4 rounded-lg font-semibold transition ${mobileView === 'preview' ? 'bg-red-600 text-white' : 'bg-white text-gray-700 border border-gray-300'}` }, "Podgląd")
        ),
        React.createElement('div', { className: "w-full max-w-7xl flex flex-col md:flex-row gap-8" },
          React.createElement('div', { id: "cv-form-container", className: "w-full md:w-1/2" },
            React.createElement('div', { id: "cv-form", className: "bg-white p-6 rounded-lg shadow-xl h-full" },
              React.createElement(CvForm, { cvData: cvData, setCvData: setCvData })
            )
          ),
          React.createElement('div', { id: "cv-preview-container", className: "w-full md:w-1/2 flex justify-center" },
            React.createElement('div', { id: "cv-preview", className: "transform scale-[0.9] md:scale-[0.8] lg:scale-[0.9] origin-top" },
              React.createElement(CvPreview, { cvData: cvData, id: "cv-to-print" })
            )
          )
        )
      );
    }

    // --- RENDER APP ---
    const container = document.getElementById('root');
    if (container) {
      const root = ReactDOM.createRoot(container);
      root.render(React.createElement(App));
    } else {
      console.error('Root element not found');
    }
  </script>
</body>
</html>
